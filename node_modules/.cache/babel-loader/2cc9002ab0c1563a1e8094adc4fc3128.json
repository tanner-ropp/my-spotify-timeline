{"ast":null,"code":"var _jsxFileName = \"/Users/twropp/Desktop/Summer-Projects/spotify-timeline-app/client/src/App.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport Spotify from 'spotify-web-api-js';\nimport ReleaseCard from './components/ReleaseCard.js';\nimport InfiniteScroll from 'react-infinite-scroll-component';\nconst spotifyWebApi = new Spotify();\nconst BACKEND_PORT = process.env.PORT || 8888; //const calendar = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n//const today = new Date();\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    const params = this.getHashParams();\n    this.state = {\n      loggedIn: params.access_token ? true : false,\n      artists: [],\n      // just artists\n      //artistAlbums : [], // albums grouped by artist,\n      artistReleases: [],\n      loadedReleases: [],\n      userDataReceived: false,\n      // used to control rendering,\n      displayName: \"\",\n      profileImage: \"\",\n      hasMore: true,\n      nowPlaying: {}\n    };\n\n    if (params.access_token && params.state === localStorage.getItem('auth_state')) {\n      spotifyWebApi.setAccessToken(params.access_token);\n      localStorage.removeItem('auth_state');\n      console.log(\"hmm\");\n    }\n\n    console.log(\"constructor\");\n    this.fetchData = this.fetchData.bind(this);\n    this.tick = this.tick.bind(this);\n    this.generateRandomState = this.generateRandomState.bind(this);\n  }\n\n  componentDidMount() {\n    if (this.state.loggedIn) {\n      console.log(\"logged in did mount\");\n      spotifyWebApi.getMe().then(response => {\n        this.setState({\n          displayName: response.display_name,\n          profileImage: response.images[0].url\n        });\n      });\n      spotifyWebApi.getFollowedArtists({\n        limit: 50\n      }) // WHAT IF YOU HAVE MORE THAN 50 FOLLOWED ARTISTS?\n      .then(response => {\n        // waits for artists followed\n\n        /*this.setState({\n            artists : response.artists.items\n        });*/\n        return response.artists.items.map(artist => {\n          return {\n            name: artist.name,\n            id: artist.id\n          };\n        });\n      }).then(artists => {\n        // waits for artist id array\n        const artistAlbums = artists.map(artist => {\n          return spotifyWebApi.getArtistAlbums(artist.id, {\n            limit: 50,\n            country: 'US',\n            include_groups: 'album,single'\n          }).then(albums => {\n            return albums.items;\n          });\n        });\n        return Promise.all(artistAlbums);\n      }).then(albums => {\n        const releases = albums.flat().sort((a, b) => a.release_date < b.release_date ? 1 : -1);\n        this.setState({\n          artistReleases: releases,\n          // hack for chrome functionality\n          loadedReleases: releases.slice(0, 10),\n          //artistAlbums: albums,\n          userDataReceived: true\n        });\n      });\n    }\n\n    this.checkInterval = setInterval(() => {\n      this.tick();\n    }, 1000);\n  }\n\n  tick() {\n    if (this.state.loggedIn) {\n      spotifyWebApi.getMyCurrentPlayingTrack().then(track => {\n        this.setState({\n          nowPlaying: track\n        });\n      });\n    }\n  }\n\n  generateRandomState(length) {\n    var text = '';\n    var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n    for (var i = 0; i < length; i++) {\n      text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    return text;\n  }\n\n  requestAuthorization() {\n    console.log(\"requesting\");\n    var client_id = process.env.REACT_APP_SPOTIFY_CLIENT_ID; // client id\n\n    console.log(client_id);\n    const redirect_uri = process.env.REDIRECT_URI || 'http://localhost:3000'; // redirect uri\n\n    var state = generateRandomState(16);\n    localStorage.setItem('auth_state', state);\n    const scope = 'user-read-private user-read-email';\n    var url = 'https://accounts.spotify.com/authorize';\n    url += '?response_type=token';\n    url += '&client_id=' + encodeURIComponent(client_id);\n    url += '&scope=' + encodeURIComponent(scope);\n    url += '&redirect_uri=' + encodeURIComponent(redirect_uri);\n    url += '&state=' + encodeURIComponent(state);\n    window.location = url;\n  }\n\n  fetchData() {\n    const oldLength = this.state.loadedReleases.length;\n    this.setState({\n      loadedReleases: this.state.loadedReleases.concat(this.state.artistReleases.slice(oldLength, oldLength + 10))\n    });\n    console.log(\"FETCH\");\n  }\n\n  getHashParams() {\n    // provided by jmperez\n    var hashParams = {};\n    var e,\n        r = /([^&;=]+)=?([^&;]*)/g,\n        q = window.location.hash.substring(1);\n\n    while (e = r.exec(q)) {\n      hashParams[e[1]] = decodeURIComponent(e[2]);\n    }\n\n    return hashParams;\n  }\n\n  render() {\n    //const artistsFollowed = this.state.artists;\n    //console.log(\"app rendered\");\n\n    /*const artistReleases = this.state.artistReleases;\n    const releaseList = artistReleases.map((release)=> {\n        return (\n            <ReleaseCard key={release.id} releaseInfo={release}/>\n        );\n    })*/\n    const loadedReleases = this.state.loadedReleases;\n    const releaseList = loadedReleases.map(release => {\n      return /*#__PURE__*/React.createElement(ReleaseCard, {\n        key: release.id,\n        releaseInfo: release,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 13\n        }\n      });\n    });\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"header\", {\n      className: \"stickyHeader\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      className: \"header-brand\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 17\n      }\n    }, \"My Music Timeline\"), this.state.nowPlaying.item && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"now-playing\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"current-art\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: this.state.nowPlaying.item.album.images[0].url,\n      height: \"60px\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 29\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"current-track\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 29\n      }\n    }, this.state.nowPlaying.item.name), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 29\n      }\n    }, \"by \", this.state.nowPlaying.item.artists[0].name))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"header-profile\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"displayName\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 21\n      }\n    }, this.state.displayName), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"imageCropper\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: this.state.profileImage,\n      height: \"50px\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 51\n      }\n    })))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 13\n      }\n    }, !this.state.loggedIn &&\n    /*#__PURE__*/\n\n    /*<a href={\"http://localhost:\" + BACKEND_PORT + \"/login\"}>\n        <button onClick={this.requestAuthorization}>Login to Spotify</button>\n    </a>*/\n    React.createElement(\"button\", {\n      onClick: this.requestAuthorization,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 21\n      }\n    }, \"Login to Spotify\"), /*#__PURE__*/React.createElement(InfiniteScroll, {\n      dataLength: this.state.loadedReleases.length //This is important field to render the next data\n      ,\n      next: this.fetchData,\n      hasMore: this.state.hasMore,\n      loader: /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 27\n        }\n      }, \"Loading...\"),\n      endMessage: /*#__PURE__*/React.createElement(\"p\", {\n        style: {\n          textAlign: 'center'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 23\n        }\n      }, \"Yay! You have seen it all\")),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 17\n      }\n    }, releaseList)), /*#__PURE__*/React.createElement(\"footer\", {\n      className: \"stickyFooter\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"small\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 17\n      }\n    }, \"\\xA9 2020, Tanner Ropp\")));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/twropp/Desktop/Summer-Projects/spotify-timeline-app/client/src/App.js"],"names":["React","Component","Spotify","ReleaseCard","InfiniteScroll","spotifyWebApi","BACKEND_PORT","process","env","PORT","App","constructor","props","params","getHashParams","state","loggedIn","access_token","artists","artistReleases","loadedReleases","userDataReceived","displayName","profileImage","hasMore","nowPlaying","localStorage","getItem","setAccessToken","removeItem","console","log","fetchData","bind","tick","generateRandomState","componentDidMount","getMe","then","response","setState","display_name","images","url","getFollowedArtists","limit","items","map","artist","name","id","artistAlbums","getArtistAlbums","country","include_groups","albums","Promise","all","releases","flat","sort","a","b","release_date","slice","checkInterval","setInterval","getMyCurrentPlayingTrack","track","length","text","possible","i","charAt","Math","floor","random","requestAuthorization","client_id","REACT_APP_SPOTIFY_CLIENT_ID","redirect_uri","REDIRECT_URI","setItem","scope","encodeURIComponent","window","location","oldLength","concat","hashParams","e","r","q","hash","substring","exec","decodeURIComponent","render","releaseList","release","item","album","textAlign"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport './App.css';\nimport Spotify from 'spotify-web-api-js'\nimport ReleaseCard from './components/ReleaseCard.js'\nimport InfiniteScroll from 'react-infinite-scroll-component';\n\nconst spotifyWebApi = new Spotify();\nconst BACKEND_PORT = process.env.PORT || 8888;\n//const calendar = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n//const today = new Date();\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    const params = this.getHashParams();\n\n    this.state = {\n        loggedIn : params.access_token ? true : false,\n        artists : [], // just artists\n        //artistAlbums : [], // albums grouped by artist,\n        artistReleases : [],\n        loadedReleases : [],\n        userDataReceived : false, // used to control rendering,\n        displayName: \"\",\n        profileImage: \"\",\n        hasMore: true,\n        nowPlaying: {}\n    }\n\n    if (params.access_token && (params.state === localStorage.getItem('auth_state'))) {\n        spotifyWebApi.setAccessToken(params.access_token);\n        localStorage.removeItem('auth_state');\n        console.log(\"hmm\")\n    }\n\n    console.log(\"constructor\");\n    this.fetchData = this.fetchData.bind(this);\n    this.tick = this.tick.bind(this);\n    this.generateRandomState = this.generateRandomState.bind(this);\n  }\n\n  componentDidMount() {\n      if (this.state.loggedIn) {\n          console.log(\"logged in did mount\")\n          spotifyWebApi.getMe().then((response) => {this.setState({displayName: response.display_name, profileImage: response.images[0].url})})\n\n          spotifyWebApi.getFollowedArtists({limit:50}) // WHAT IF YOU HAVE MORE THAN 50 FOLLOWED ARTISTS?\n          .then((response) => { // waits for artists followed\n              /*this.setState({\n                  artists : response.artists.items\n              });*/\n              return response.artists.items.map((artist) => {return {name : artist.name, id : artist.id}});\n          })\n          .then((artists) => { // waits for artist id array\n              const artistAlbums = artists.map((artist) => {\n                  return spotifyWebApi.getArtistAlbums(artist.id, {limit:50, country:'US', include_groups: 'album,single'})\n                  .then((albums) => {\n                      return (albums.items);\n                  })\n              });\n              return Promise.all(artistAlbums);\n          })\n          .then((albums) => {\n              const releases = albums.flat().sort((a,b) => a.release_date < b.release_date ? 1 : -1);\n              this.setState({\n                  artistReleases : releases, // hack for chrome functionality\n                  loadedReleases : releases.slice(0,10),\n                  //artistAlbums: albums,\n                  userDataReceived : true\n              });\n          });\n      }\n      this.checkInterval = setInterval(() => {this.tick()}, 1000);\n  }\n\n  tick() {\n      if (this.state.loggedIn) {\n          spotifyWebApi.getMyCurrentPlayingTrack()\n          .then((track) => {\n              this.setState({\n                  nowPlaying: track\n              })\n          })\n      }\n  }\n\n  generateRandomState(length) {\n    var text = '';\n    var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n    for (var i = 0; i < length; i++) {\n      text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n    return text;\n  }\n\n  requestAuthorization() {\n      console.log(\"requesting\");\n\n      var client_id = process.env.REACT_APP_SPOTIFY_CLIENT_ID; // client id\n      console.log(client_id);\n      const redirect_uri = process.env.REDIRECT_URI || 'http://localhost:3000'; // redirect uri\n\n      var state = generateRandomState(16);\n\n      localStorage.setItem('auth_state', state);\n      const scope = 'user-read-private user-read-email';\n\n      var url = 'https://accounts.spotify.com/authorize';\n      url += '?response_type=token';\n      url += '&client_id=' + encodeURIComponent(client_id);\n      url += '&scope=' + encodeURIComponent(scope);\n      url += '&redirect_uri=' + encodeURIComponent(redirect_uri);\n      url += '&state=' + encodeURIComponent(state);\n\n      window.location = url;\n  }\n\n  fetchData() {\n      const oldLength = this.state.loadedReleases.length;\n      this.setState({\n          loadedReleases : this.state.loadedReleases.concat(this.state.artistReleases.slice(oldLength, oldLength + 10))\n      })\n      console.log(\"FETCH\");\n  }\n\n  getHashParams() { // provided by jmperez\n    var hashParams = {};\n    var e, r = /([^&;=]+)=?([^&;]*)/g,\n        q = window.location.hash.substring(1);\n    while ( e = r.exec(q)) {\n       hashParams[e[1]] = decodeURIComponent(e[2]);\n    }\n    return hashParams;\n  }\n\n  render() {\n      //const artistsFollowed = this.state.artists;\n      //console.log(\"app rendered\");\n\n    /*const artistReleases = this.state.artistReleases;\n    const releaseList = artistReleases.map((release)=> {\n        return (\n            <ReleaseCard key={release.id} releaseInfo={release}/>\n        );\n    })*/\n\n    const loadedReleases = this.state.loadedReleases;\n    const releaseList = loadedReleases.map((release)=> {\n        return (\n            <ReleaseCard key={release.id} releaseInfo={release}/>\n        );\n    })\n\n      return (\n        <div className=\"App\">\n            <header className=\"stickyHeader\">\n                <h1 className=\"header-brand\">My Music Timeline</h1>\n                {this.state.nowPlaying.item &&\n                    <div className=\"now-playing\">\n                        <div className=\"current-art\">\n                            <img src={this.state.nowPlaying.item.album.images[0].url} height=\"60px\"></img>\n                        </div>\n                        <div className=\"current-track\">\n                            <div>{this.state.nowPlaying.item.name}</div>\n                            <div>by {this.state.nowPlaying.item.artists[0].name}</div>\n                        </div>\n                    </div>\n                }\n                <div className=\"header-profile\">\n                    <div className=\"displayName\">{this.state.displayName}</div>\n                    <div className=\"imageCropper\"><img src={this.state.profileImage} height=\"50px\"/></div>\n                </div>\n            </header>\n            <div className=\"body\">\n                {!this.state.loggedIn &&\n                    /*<a href={\"http://localhost:\" + BACKEND_PORT + \"/login\"}>\n                        <button onClick={this.requestAuthorization}>Login to Spotify</button>\n                    </a>*/\n                    <button onClick={this.requestAuthorization}>Login to Spotify</button>\n                }\n                <InfiniteScroll\n                  dataLength={this.state.loadedReleases.length} //This is important field to render the next data\n                  next={this.fetchData}\n                  hasMore={this.state.hasMore}\n                  loader={<h4>Loading...</h4>}\n                  endMessage={\n                    <p style={{textAlign: 'center'}}>\n                      <b>Yay! You have seen it all</b>\n                    </p>\n                  }>\n                  {releaseList}\n                </InfiniteScroll>\n                {/*releaseList*/}\n            </div>\n            <footer className=\"stickyFooter\">\n                <small>&copy; 2020, Tanner Ropp</small>\n            </footer>\n        </div>\n      );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}